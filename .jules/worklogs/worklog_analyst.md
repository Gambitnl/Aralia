## 2024-05-21 - HP Pool Allocation Gap **Learning:** Spells like Sleep and Color Spray use a "resource pool allocation" targeting logic that doesn't exist in the current `AreaTargeting` system. They require rolling dice to determine a pool, sorting targets by a property (HP), and iteratively applying effects until the pool is exhausted. **Action:** Introduced `TargetAllocation` interface to `src/types/spells.ts` and created `TargetAllocator` service to handle this logic. Future complex targeting (like Chain Lightning's "nearest" logic) should follow this pattern.

## 2024-10-24 - Object Targeting Gap **Learning:** The current targeting system (`TargetResolver`) is strictly `CombatCharacter`-based. Spells like *Animate Dead* or *Catapult* that target items/objects cannot be implemented without extending `validTargets` to support `Item` validation and introducing an `ObjectTargeting` service. **Action:** Created `ObjectTargeting` framework to allow validating `Item` targets against filters like `objectType: "corpse"`. Future spells targeting items should use `ObjectTargeting.isValidObjectTarget` instead of shoehorning items into `CombatCharacter` types.

## 2024-06-18 - Creature Type Taxonomy Gap **Learning:** Spells frequently interact with creature types (e.g., *Hold Person* targeting only Humanoids, *Protection from Evil and Good* excluding specific types), but the codebase relied on brittle string comparisons and disparate logic. **Action:** Created `CreatureTaxonomy` system to centralize normalization, whitelist/blacklist validation, and trait lookups, ensuring consistent and type-safe creature interactions across spells and features.

## 2024-01-26 - Attack Interception System Gap **Learning:** Spells like *Mirror Image* and *Sanctuary* require an 'interception' phase before an attack roll is made. The existing `AttackEventEmitter` had a `redirectTargetId` field but no system to populate it dynamically based on game state/dice rolls. **Action:** Created `InterceptionSystem` framework in `src/systems/combat/interception/` to handle these pre-attack checks. Future redirection spells should implement `InterceptionLogic`.
