/**
 * Craftable item definitions (potions, oils, poisons, bombs).
 * Costs use rough rarity-based defaults; TODO(preserve-lint): revisit values and mechanical details during balance pass.
 */
import { Item, ItemEffect, ItemRarity, ItemType } from '../types';

const healEffect = (value: number, dice: string): ItemEffect => ({ type: 'heal', value, dice });
const damageEffect = (damageType: string, dice: string): ItemEffect => ({ type: 'damage', damageType, dice });
const utilityEffect = (description: string): ItemEffect => ({ type: 'utility', description });
const buffEffect = (value: number, durationMinutes?: number): ItemEffect => ({ type: 'buff', value, duration: durationMinutes });

export const CRAFTED_ITEMS: Record<string, Item> = {
  // ============ COMMON CRAFTED ITEMS ============
  alchemists_fire: {
    id: 'alchemists_fire',
    name: "Alchemist's Fire",
    type: ItemType.Consumable,
    category: 'Bomb',
    description: "Thrown (20ft). On hit: target takes 1d4 fire damage at the start of each turn until it's extinguished.",
    cost: '50',
    weight: 1,
    rarity: ItemRarity.Common,
    // TODO(preserve-lint): model ongoing burn/Extinguish action instead of single damage roll.
    effect: damageEffect('fire', '1d4'),
  },
  smokebomb: {
    id: 'smokebomb',
    name: 'Smokebomb',
    type: ItemType.Consumable,
    category: 'Bomb',
    description: 'Thrown (30ft). Creates heavily obscured area (10ft radius) + lightly obscured area (additional 5ft) for 1 minute.',
    cost: '25',
    weight: 0.5,
    rarity: ItemRarity.Common,
    effect: utilityEffect('Obscures a small area for 1 minute to break line of sight.'),
  },
  blasting_powder: {
    id: 'blasting_powder',
    name: 'Blasting Powder',
    type: ItemType.Consumable,
    category: 'Bomb',
    description: 'Explodes when ignited (5ft radius). DC 13 Dex save or 3d6 bludgeoning damage. Charges can be combined.',
    cost: '75',
    weight: 0.5,
    rarity: ItemRarity.Common,
    // TODO(preserve-lint): encode save DC and combined charge scaling once bomb mechanics are formalized.
    effect: damageEffect('bludgeoning', '3d6'),
  },
  potion_of_climbing: {
    id: 'potion_of_climbing',
    name: 'Potion of Climbing',
    type: ItemType.Potion,
    category: 'Potion',
    description: 'Gain climb speed equal to walking speed for 1 hour; advantage on Athletics (Climbing) checks.',
    cost: '50',
    weight: 0.5,
    rarity: ItemRarity.Common,
    effect: utilityEffect('One-hour climbing speed boost with advantage on climbing checks.'),
  },
  potion_of_swimming: {
    id: 'potion_of_swimming',
    name: 'Potion of Swimming',
    type: ItemType.Potion,
    category: 'Potion',
    description: 'Gain swim speed equal to walking speed for 1 hour; advantage on Athletics (Swimming) checks.',
    cost: '50',
    weight: 0.5,
    rarity: ItemRarity.Common,
    effect: utilityEffect('One-hour swim speed boost with advantage on swimming checks.'),
  },
  vial_of_acid: {
    id: 'vial_of_acid',
    name: 'Vial of Acid',
    type: ItemType.Consumable,
    category: 'Bomb',
    description: 'Thrown (20ft). On hit: 2d6 acid damage.',
    cost: '50',
    weight: 1,
    rarity: ItemRarity.Common,
    effect: damageEffect('acid', '2d6'),
  },
  healing_salve: {
    id: 'healing_salve',
    name: 'Healing Salve',
    type: ItemType.Potion,
    category: 'Potion',
    description: 'Apply to heal 2d4+2 HP. Takes 1 action to apply.',
    cost: '50',
    weight: 0.25,
    rarity: ItemRarity.Common,
    effect: healEffect(7, '2d4+2'),
  },
  antitoxin: {
    id: 'antitoxin',
    name: 'Antitoxin',
    type: ItemType.Potion,
    category: 'Potion',
    description: 'Advantage on saving throws against poison for 1 hour.',
    cost: '50',
    weight: 0.25,
    rarity: ItemRarity.Common,
    // TODO(preserve-lint): move to a status-effect representation when saves/conditions are formalized.
    effect: utilityEffect('Advantage on poison saves for one hour.'),
  },
  basic_poison: {
    id: 'basic_poison',
    name: 'Basic Poison',
    type: ItemType.Potion,
    category: 'Poison',
    description: 'Coat one weapon or 3 pieces of ammunition. Hit: DC 10 Con save or 1d4 poison damage. Lasts 1 minute.',
    cost: '100',
    weight: 0.1,
    rarity: ItemRarity.Common,
    effect: damageEffect('poison', '1d4'),
  },

  // ============ UNCOMMON CRAFTED ITEMS ============
  oil_of_slipperiness: {
    id: 'oil_of_slipperiness',
    name: 'Oil of Slipperiness',
    type: ItemType.Consumable,
    category: 'Oil',
    description: 'Apply for Freedom of Movement (8 hours) or pour to create Grease effect (10ft square, 8 hours).',
    cost: '200',
    weight: 0.5,
    rarity: ItemRarity.Uncommon,
    effect: utilityEffect('Choice: long-duration Freedom of Movement or Grease-style terrain.'),
  },
  potion_of_animal_friendship: {
    id: 'potion_of_animal_friendship',
    name: 'Potion of Animal Friendship',
    type: ItemType.Potion,
    category: 'Potion',
    description: 'Cast Animal Friendship (save DC 13) at will for 1 hour after drinking.',
    cost: '200',
    weight: 0.5,
    rarity: ItemRarity.Uncommon,
    effect: utilityEffect('One-hour Animal Friendship casts (DC 13).'),
  },
  potion_of_fire_breath: {
    id: 'potion_of_fire_breath',
    name: 'Potion of Fire Breath',
    type: ItemType.Potion,
    category: 'Potion',
    description: 'Bonus action: exhale fire in a 30ft cone. DC 13 Dex save or 4d6 fire damage. 3 uses or 1 hour.',
    cost: '200',
    weight: 0.5,
    rarity: ItemRarity.Uncommon,
    // TODO(preserve-lint): support limited charges; for now capture the damage profile.
    effect: damageEffect('fire', '4d6'),
  },
  potion_of_growth: {
    id: 'potion_of_growth',
    name: 'Potion of Growth',
    type: ItemType.Potion,
    category: 'Potion',
    description: 'Enlarge effect (as the spell) for 1d4 hours. No concentration required.',
    cost: '200',
    weight: 0.5,
    rarity: ItemRarity.Uncommon,
    effect: utilityEffect('Enlarge effect for hours without concentration.'),
  },
  potion_of_waterbreathing: {
    id: 'potion_of_waterbreathing',
    name: 'Potion of Waterbreathing',
    type: ItemType.Potion,
    category: 'Potion',
    description: 'Breathe underwater for 1 hour.',
    cost: '200',
    weight: 0.5,
    rarity: ItemRarity.Uncommon,
    effect: utilityEffect('Underwater breathing for one hour.'),
  },
  potion_of_healing_greater: {
    id: 'potion_of_healing_greater',
    name: 'Potion of Greater Healing',
    type: ItemType.Potion,
    category: 'Potion',
    description: 'Heal 4d4+4 HP when consumed.',
    cost: '200',
    weight: 0.5,
    rarity: ItemRarity.Uncommon,
    effect: healEffect(14, '4d4+4'),
  },
  serpent_venom_poison: {
    id: 'serpent_venom_poison',
    name: 'Serpent Venom (Poison)',
    type: ItemType.Potion,
    category: 'Poison',
    description: 'Injury poison. DC 11 Con save or take 3d6 poison damage.',
    cost: '200',
    weight: 0.1,
    rarity: ItemRarity.Uncommon,
    effect: damageEffect('poison', '3d6'),
  },
  truth_serum: {
    id: 'truth_serum',
    name: 'Truth Serum',
    type: ItemType.Potion,
    category: 'Poison',
    description: 'Ingested. DC 11 Con save or the creature cannot knowingly speak a lie for 1 hour.',
    cost: '200',
    weight: 0.1,
    rarity: ItemRarity.Uncommon,
    effect: utilityEffect('Prevents lying for one hour on failed save.'),
  },

  // ============ RARE CRAFTED ITEMS ============
  invisible_ink: {
    id: 'invisible_ink',
    name: 'Invisible Ink',
    type: ItemType.Consumable,
    category: 'Ink',
    description: 'Text written with this ink is invisible. Revealed by Detect Magic, See Invisibility, or mild acid.',
    cost: '1000',
    weight: 0.1,
    rarity: ItemRarity.Rare,
    effect: utilityEffect('Hidden writing revealed by specific magic or reagents.'),
  },
  midnight_oil: {
    id: 'midnight_oil',
    name: 'Midnight Oil',
    type: ItemType.Consumable,
    category: 'Oil',
    description: 'Light source (5ft bright/5ft dim) for 8 hours. Resting in its light grants long-rest benefits for light activity.',
    cost: '1000',
    weight: 0.5,
    rarity: ItemRarity.Rare,
    effect: utilityEffect('Eight-hour restorative light source that improves resting.'),
  },
  oil_of_dragons_bane: {
    id: 'oil_of_dragons_bane',
    name: "Oil of Dragon's Bane",
    type: ItemType.Consumable,
    category: 'Oil',
    description: 'Coat 1 weapon or 3 ammunition. For 1 hour, deal +6d6 damage against Dragons.',
    cost: '1000',
    weight: 0.5,
    rarity: ItemRarity.Rare,
    // TODO(preserve-lint): formalize creature-type bonus damage instead of narrative utility.
    effect: utilityEffect('Adds significant bonus damage vs Dragons for one hour.'),
  },
  potion_of_gaseous_form: {
    id: 'potion_of_gaseous_form',
    name: 'Potion of Gaseous Form',
    type: ItemType.Potion,
    category: 'Potion',
    description: 'Transform into a misty cloud (as the Gaseous Form spell) for 1 hour. No concentration.',
    cost: '1000',
    weight: 0.5,
    rarity: ItemRarity.Rare,
    effect: utilityEffect('One-hour Gaseous Form without concentration.'),
  },
  oil_of_etherealness: {
    id: 'oil_of_etherealness',
    name: 'Oil of Etherealness',
    type: ItemType.Consumable,
    category: 'Oil',
    description: 'Etherealness effect for 1 hour. Takes 10 minutes to apply.',
    cost: '1000',
    weight: 0.5,
    rarity: ItemRarity.Rare,
    effect: utilityEffect('Grants Etherealness for an hour after application.'),
  },
  potion_of_clairvoyance: {
    id: 'potion_of_clairvoyance',
    name: 'Potion of Clairvoyance',
    type: ItemType.Potion,
    category: 'Potion',
    description: 'Gain the effect of the Clairvoyance spell.',
    cost: '1000',
    weight: 0.5,
    rarity: ItemRarity.Rare,
    effect: utilityEffect('Clairvoyance effect once consumed.'),
  },
  potion_of_diminution: {
    id: 'potion_of_diminution',
    name: 'Potion of Diminution',
    type: ItemType.Potion,
    category: 'Potion',
    description: 'Reduce effect (as the spell) for 1d4 hours. No concentration.',
    cost: '1000',
    weight: 0.5,
    rarity: ItemRarity.Rare,
    effect: utilityEffect('Shrink effect for hours without concentration.'),
  },
  potion_of_heroism: {
    id: 'potion_of_heroism',
    name: 'Potion of Heroism',
    type: ItemType.Potion,
    category: 'Potion',
    description: 'Gain 10 temporary HP and the Bless effect (no concentration) for 1 hour.',
    cost: '1000',
    weight: 0.5,
    rarity: ItemRarity.Rare,
    // TODO(preserve-lint): split temp HP and Bless bonuses explicitly.
    effect: buffEffect(10, 60),
  },
  potion_of_mind_reading: {
    id: 'potion_of_mind_reading',
    name: 'Potion of Mind Reading',
    type: ItemType.Potion,
    category: 'Potion',
    description: 'Detect Thoughts (DC 13) as the spell.',
    cost: '1000',
    weight: 0.5,
    rarity: ItemRarity.Rare,
    effect: utilityEffect('Detect Thoughts (DC 13) for the potion duration.'),
  },
  potion_of_healing_superior: {
    id: 'potion_of_healing_superior',
    name: 'Potion of Superior Healing',
    type: ItemType.Potion,
    category: 'Potion',
    description: 'Heal 8d4+8 HP when consumed.',
    cost: '1000',
    weight: 0.5,
    rarity: ItemRarity.Rare,
    effect: healEffect(28, '8d4+8'),
  },
  drow_poison: {
    id: 'drow_poison',
    name: 'Drow Poison',
    type: ItemType.Potion,
    category: 'Poison',
    description: 'Injury. DC 13 Con save or creature is Poisoned and falls Unconscious for 1 hour (or until damaged/action to wake).',
    cost: '1000',
    weight: 0.1,
    rarity: ItemRarity.Rare,
    effect: utilityEffect('Poisoned + unconscious for an hour on failed save.'),
  },
  midnight_tears: {
    id: 'midnight_tears',
    name: 'Midnight Tears',
    type: ItemType.Potion,
    category: 'Poison',
    description: 'Ingested. No effect until midnight, then DC 17 Con save or 9d6 poison damage.',
    cost: '1500',
    weight: 0.1,
    rarity: ItemRarity.Rare,
    effect: damageEffect('poison', '9d6'),
  },

  // ============ VERY RARE CRAFTED ITEMS ============
  oil_of_sharpness: {
    id: 'oil_of_sharpness',
    name: 'Oil of Sharpness',
    type: ItemType.Consumable,
    category: 'Oil',
    description: 'Coat weapon or 5 ammunition. For 1 hour, gain +3 bonus to attack and damage rolls.',
    cost: '5000',
    weight: 0.5,
    rarity: ItemRarity.VeryRare,
    effect: buffEffect(3, 60),
  },
  potion_of_flying: {
    id: 'potion_of_flying',
    name: 'Potion of Flying',
    type: ItemType.Potion,
    category: 'Potion',
    description: 'Gain flying speed equal to walking speed (hover) for 1 hour.',
    cost: '5000',
    weight: 0.5,
    rarity: ItemRarity.VeryRare,
    effect: utilityEffect('One-hour fly speed equal to walk speed.'),
  },
  potion_of_invisibility: {
    id: 'potion_of_invisibility',
    name: 'Potion of Invisibility',
    type: ItemType.Potion,
    category: 'Potion',
    description: 'Invisible for 1 hour. Effect ends if you attack or cast a spell.',
    cost: '5000',
    weight: 0.5,
    rarity: ItemRarity.VeryRare,
    effect: utilityEffect('Invisibility for up to an hour; ends on attack or spell.'),
  },
  potion_of_longevity: {
    id: 'potion_of_longevity',
    name: 'Potion of Longevity',
    type: ItemType.Potion,
    category: 'Potion',
    description: 'Physical age reduced by 1d6+6 years (minimum age 13). 10% cumulative chance of aging 1d6+6 years instead.',
    cost: '5000',
    weight: 0.5,
    rarity: ItemRarity.VeryRare,
    effect: utilityEffect('Age reduction with small risk of aging instead.'),
  },
  potion_of_speed: {
    id: 'potion_of_speed',
    name: 'Potion of Speed',
    type: ItemType.Potion,
    category: 'Potion',
    description: 'Haste effect for 1 minute (no concentration). No lethargy afterward.',
    cost: '5000',
    weight: 0.5,
    rarity: ItemRarity.VeryRare,
    effect: utilityEffect('One-minute Haste effect without post-exhaustion.'),
  },
  potion_of_truesight: {
    id: 'potion_of_truesight',
    name: 'Potion of Truesight',
    type: ItemType.Potion,
    category: 'Potion',
    description: 'Gain Truesight out to 120 feet for 1 hour.',
    cost: '5000',
    weight: 0.5,
    rarity: ItemRarity.VeryRare,
    effect: utilityEffect('Truesight 120 ft for one hour.'),
  },
  potion_of_healing_supreme: {
    id: 'potion_of_healing_supreme',
    name: 'Potion of Supreme Healing',
    type: ItemType.Potion,
    category: 'Potion',
    description: 'Heal 10d4+20 HP when consumed.',
    cost: '5000',
    weight: 0.5,
    rarity: ItemRarity.VeryRare,
    effect: healEffect(45, '10d4+20'),
  },
  purple_worm_poison_vial: {
    id: 'purple_worm_poison_vial',
    name: 'Purple Worm Poison (Vial)',
    type: ItemType.Potion,
    category: 'Poison',
    description: 'Injury. DC 19 Con save or 12d6 poison damage. Half on success.',
    cost: '5000',
    weight: 0.1,
    rarity: ItemRarity.VeryRare,
    effect: damageEffect('poison', '12d6'),
  },
};
