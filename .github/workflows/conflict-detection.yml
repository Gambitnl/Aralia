# Auto-detect and notify about merge conflicts
# When master changes, checks all open PRs and posts comments on conflicting ones
# Jules (watching the PR) will see the comment and rebase automatically

name: üîÄ Conflict Detection

on:
  push:
    branches: [master]

jobs:
  detect-conflicts:
    name: Check for Conflicts
    runs-on: ubuntu-latest
    permissions:
      contents: read
      pull-requests: write
    
    steps:
      - uses: eps1lon/actions-label-merge-conflict@v3.0.2
        with:
          dirtyLabel: "‚ö†Ô∏è has-conflicts"
          removeOnDirtyBaseBranch: true
          repoToken: ${{ secrets.GITHUB_TOKEN }}
          
          commentOnDirty: |
            ‚ö†Ô∏è **Merge Conflict Detected**
            
            This PR can no longer merge cleanly into `master`. Please rebase:
            
            ```bash
            git fetch origin
            git rebase origin/master
            # Resolve any conflicts
            git push --force
            ```
            
            **Important Rules:**
            - ‚ùå Do NOT commit `package-lock.json` or `tsconfig.tsbuildinfo`
            - ‚úÖ Accept the incoming (master) version for shared files when in doubt
            - üîÑ If conflicts persist, run: `git checkout origin/master -- <conflicting-file>`
            
          commentOnClean: |
            ‚úÖ **Conflicts Resolved**
            
            This PR can now be merged cleanly. Thank you!
