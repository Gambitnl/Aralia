# Guide: Designing Glossary Entries

This guide outlines the structure, content, and styling conventions for creating and updating glossary entries in the Aralia RPG application, using spell and rule entries as primary examples.

## 1. File Structure Overview

*   **Content Source**: All glossary content files are JSON files (`.json`) located under `public/data/glossary/entries/`. Each file contains a `markdown` field holding the rendered content.
*   **Organization**: Entries are organized by category into subdirectories (e.g., `rules/`, `classes/`, `races/`).
*   **Index Files**: The `GlossaryProvider` uses JSON index files located in `public/data/glossary/index/` to find and load the content. These are generated by a script.
*   **Spells**: Spells are not stored as glossary entry content files anymore; the Spells category is generated from `public/data/spells_manifest.json` and rendered from spell JSON (`public/data/spells/level-{N}/{id}.json`).

## 2. Entry File Naming and Creation/Update

*   **Convention**: `[id_kebab_case].json`. The filename must use kebab-case (e.g., `conditions.json`, not `conditions_overview.json` unless the ID matches).
*   **Action**: Before creating a new file, check if a file for that term already exists. If it does, update the existing file. If not, create a new one. The filename (without `.json`) should exactly match the `id` field inside the JSON.

<div class="glossary-callout" style="border-left-color: #60a5fa;"> <!-- blue-500 -->
  <h4 style="color: #93c5fd;">Recommended Workflow</h4>
  <p>For adding new spells, it's highly recommended to use the `add_spell.js` script. It creates the spell JSON and updates `spells_manifest.json` and the glossary indexes. See the <span data-term-id="spell_addition_workflow_guide" class="glossary-term-link-from-markdown">Spell Addition Workflow Guide</span> for details.</p>
</div>

## 3. Entry JSON Shape (Required)

Each entry file is a JSON object with metadata fields and a `markdown` field for content.

```json
{
  "id": "conditions",
  "title": "Conditions (Overview)",
  "category": "Rules Glossary",
  "tags": ["rules", "condition", "status effect"],
  "excerpt": "Many effects impose a condition, a temporary state that alters the recipient's capabilities.",
  "aliases": ["status effects"],
  "seeAlso": ["blinded_condition", "charmed_condition"],
  "filePath": "/data/glossary/entries/rules/conditions.json",
  "markdown": "# Conditions\n\n..."
}
```

<div class="glossary-callout" style="border-left-color: #f87171;"> <!-- red-500 -->
  <h4 style="color: #fca5a5;">⚠️ Critical: File Integrity Checks</h4>
  <p>The glossary generation script performs several checks. It will fail if:</p>
  <ul>
    <li>An entry is missing a required frontmatter field (`id`, `title`, `category`, `filePath`).</li>
    <li>The `id` field does not exactly match the filename (e.g., `id: "healing_word"` in `healing-word.md` will fail).</li>
    <li>Two or more entries share the same `id`.</li>
    <li>The `filePath` does not accurately point to the file's location within the `/public` directory.</li>
  </ul>
  <p>A failure in the script will prevent the glossary indexes from being updated, which can lead to application errors.</p>
</div>

<div class="glossary-callout" style="border-left-color: #fbbf24;"> <!-- amber-400 -->
  <h4 style="color: #fcd34d;">Troubleshooting Guide</h4>
  <p>If the application fails to load with a JSON parsing error (e.g., "Unexpected non-whitespace character" or "Unterminated string"), or if a glossary link results in a "404 Not Found" error, the root cause is almost always a mistake in one of the source `.json` files.</p>
  <p>Carefully check your most recently edited glossary entry file for JSON syntax errors or mismatches between the `id` and the filename.</p>
</div>

## 4. Spell Entries

Spell glossary entries are rendered directly from spell JSON (`public/data/spells/level-{N}/{id}.json`) via `SpellCardTemplate.tsx`. Do not create separate glossary entry content files for spells.

### Legacy (Deprecated): Spell Card HTML Template
<div class="glossary-callout">
  <h4 style="color: #60a5fa;">Note: No Duplicate Title</h4>
  <p>When using the <code>&lt;div class="spell-card"&gt;</code> template below, **do not** add a separate Markdown heading like <code># Spell Name</code>. The title is already handled by the <code>&lt;h1 class="spell-card-title"&gt;</code> element inside the template.</p>
</div>

```html
<div class="spell-card">
  <div class="spell-card-header">
    <h1 class="spell-card-title">Shield of Faith</h1>
    <div class="spell-card-symbol" title="Concentration"><span class="spell-card-symbol-inner">C</span></div>
  </div>
  <div class="spell-card-divider"></div>
  <div class="spell-card-stats-grid">
    <div class="spell-card-stat">
      <span class="spell-card-stat-label">Level</span>
      <span class="spell-card-stat-value">1st</span>
    </div>
    <div class="spell-card-stat">
      <span class="spell-card-stat-label">Casting Time</span>
      <span class="spell-card-stat-value">1 Bonus Action</span>
    </div>
    <div class="spell-card-stat">
      <span class="spell-card-stat-label">Range/Area</span>
      <span class="spell-card-stat-value">60 ft.</span>
    </div>
    <div class="spell-card-stat">
      <span class="spell-card-stat-label">Components</span>
      <span class="spell-card-stat-value">V, S, M *</span>
    </div>
    <div class="spell-card-stat">
      <span class="spell-card-stat-label">Duration</span>
      <span class="spell-card-stat-value"><div class="concentration-icon"></div> 10 Minutes</span>
    </div>
    <div class="spell-card-stat">
      <span class="spell-card-stat-label">School</span>
      <span class="spell-card-stat-value">Abjuration</span>
    </div>
    <div class="spell-card-stat">
      <span class="spell-card-stat-label">Attack/Save</span>
      <span class="spell-card-stat-value">None</span>
    </div>
    <div class="spell-card-stat">
      <span class="spell-card-stat-label">Damage/Effect</span>
      <span class="spell-card-stat-value">Buff</span>
    </div>
  </div>
  <div class="spell-card-divider"></div>
  <p class="spell-card-description">
    A shimmering field surrounds a creature of your choice within range, granting it a +2 bonus to AC for the duration.
  </p>
  <p class="spell-card-material-note">
    * - (a small piece of parchment with a bit of holy text written on it)
  </p>
  <div class="spell-card-tags-section">
    <span class="spell-card-tags-label">Spell Tags:</span>
    <span class="spell-card-tag">BUFF</span>
    <span class="spell-card-tag">WARDING</span>
  </div>
  <div class="spell-card-tags-section">
    <span class="spell-card-tags-label">Available For:</span>
    <span class="spell-card-tag">CLERIC</span>
    <span class="spell-card-tag">PALADIN</span>
  </div>
</div>
```

### b. Customizing the Template
*   **Concentration Symbol**:
    *   To show the Concentration diamond in the header, include `<div class="spell-card-symbol" title="Concentration"><span class="spell-card-symbol-inner">C</span></div>`.
    *   To show it next to the duration, include `<div class="concentration-icon"></div>` before the duration text.
*   **Material Components**: If the spell has a material component note (like `M *`), add the description in a `<p class="spell-card-material-note">`.
*   **Tags**: Add or remove `<span class="spell-card-tag">...</span>` elements as needed for "Spell Tags" and "Available For" sections.

## 5. Content Structure for Rule Entries

Rule entries are simpler and generally use standard Markdown.

### a. Main Title (H1)
```markdown
# D20 Tests
```

### b. Content Body
*   Write the rule description using standard Markdown paragraphs, lists, and tables.
*   Use `##` and `###` for subheadings. The `GlossaryContentRenderer` will automatically turn `###` headings into collapsible `<details>` sections.
*   Use internal links (`<span data-term-id="...">`) for related terms.

## 6. Creating Hierarchical Entries (e.g., D20 Tests)

To create a nested menu in the glossary sidebar, you must **manually edit the JSON index file**.

1.  **Create All Files**: Create the Markdown files for the parent entry (e.g., `d20_test.md`) and all its children (e.g., `ability_check.md`, `ability_check_modifier.md`).
2.  **Run Indexer Script**: After creating the files, run `node scripts/generateGlossaryIndex.js`. This will add all your new entries to the appropriate category index file (e.g., `rules_glossary.json`) at the top level.
3.  **Manually Edit the JSON Index**:
    *   Open the relevant JSON file (e.g., `public/data/glossary/index/rules_glossary.json`).
    *   Find the JSON object for your **parent** entry.
    *   Create a new key on the parent object called `"subEntries"` and set its value to an empty array `[]`.
    *   Find the JSON objects for your **child** entries within the same file.
    *   **Cut** the child entry objects from the main array.
    *   **Paste** the child entry objects into the `subEntries` array of the parent object. You can nest this structure multiple levels deep.

**Example of Final JSON Structure:**
```json
[
  {
    "id": "d20_test",
    "title": "D20 Tests",
    "filePath": "/data/glossary/entries/rules/d20_test.json",
    "subEntries": [
      {
        "id": "ability_check",
        "title": "Ability Checks",
        "filePath": "/data/glossary/entries/rules/ability_check.json",
        "subEntries": [
          {
            "id": "ability_check_modifier",
            "title": "Ability Modifier",
            "filePath": "/data/glossary/entries/rules/ability_check_modifier.json"
          }
        ]
      }
    ]
  }
]
```

## 7. Final Step: Updating the Application

After adding or modifying any glossary entry `.json` files, you **must run the indexer script** (`node scripts/generateGlossaryIndex.js`). This updates the JSON index files that the application uses to load and display glossary content.
