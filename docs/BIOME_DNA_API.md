# Biome DNA API Reference

This document describes the structure and usage of the `BiomeDNA` system for procedural environment generation in Aralia.

## Overview

The `BiomeDNA` acts as a biological and geological instruction set for a biome. It is generated by AI (Gemini/Ollama) and consumed by the GPU (Shaders) and the Scattering System.

## BiomeDNA Interface

```typescript
export interface BiomeDNA {
  id: string;             // Unique identifier for the variant
  name: string;           // Descriptive name (e.g., "The Ashen Reach")
  descriptor: string;     // The original input prompt
  
  // Visuals (GPU Shader)
  primaryColor: string;   // Hex color for the base terrain
  secondaryColor: string; // Hex color for the underlayer/disturbed terrain
  roughness: number;      // 0.0 (smooth) to 1.0 (chaotic) noise scale
  
  // Scatter (Instanced Placement)
  scatter: ScatterRule[];
}
```

## ScatterRule Interface

```typescript
export interface ScatterRule {
  id: string;
  assetType: 'tree' | 'rock' | 'grass';
  preset?: string;        // Optional specific asset preset (e.g., 'pine', 'dead')
  density: number;        // Probability per area (0.0 to 1.0)
  minSlope?: number;      // Placement filter: minimum slope steepness
  maxSlope?: number;      // Placement filter: maximum slope steepness
  scaleMean: number;      // Average base scale
  scaleVar: number;       // Random variance applied to scale
}
```

## Integration Flow

1. **Generation**: `useBiomeGenerator` hook sends a prompt to Ollama/Gemini.
2. **Parsing**: The JSON response is validated and mapped to the `BiomeDNA` interface.
3. **Surface Rendering**: `DeformableTerrain` passes colors and roughness as uniforms to the `BiomeShader`.
4. **Environment Sculpting**: `DeformationManager` writes `aDisturbance` attributes to the terrain, which the shader uses to reveal `secondaryColor`.
5. **Object Placement**: `ProceduralScatter` uses the rules to randomly place instanced meshes, sampling height and slope from the `DeformationManager`.
